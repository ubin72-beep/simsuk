<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ (ÏàòÏ†ïÎê®) - Ïã¨ÏÑù</title>
    <link rel="stylesheet" href="css/admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .temp-notice {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #ff9800;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9rem;
            z-index: 10000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div class="temp-notice">
        ‚úÖ Ï£ºÎ¨∏ ÏÉÅÏÑ∏Î≥¥Í∏∞ ÏàòÏ†ï Î≤ÑÏ†Ñ
    </div>
    
    <!-- ÏõêÎ≥∏ HTML ÎÇ¥Ïö©ÏùÑ Í∑∏ÎåÄÎ°ú Ìè¨Ìï® -->
    <script>
        // admin.htmlÏùò ÏõêÎ≥∏ ÎÇ¥Ïö©ÏùÑ Î°úÎìú
        fetch('admin.html')
            .then(response => response.text())
            .then(html => {
                // body ÎÇ¥Ïö©Îßå Ï∂îÏ∂úÌïòÏó¨ ÏÇΩÏûÖ
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const bodyContent = doc.body.innerHTML;
                document.body.innerHTML += bodyContent;
                
                // ÏàòÏ†ïÎêú JavaScript Î°úÎìú
                loadFixedScript();
            });
        
        function loadFixedScript() {
            // admin.js Î°úÎìú ÌõÑ viewOrderDetail Ìï®ÏàòÎßå ÎçÆÏñ¥Ïì∞Í∏∞
            const script = document.createElement('script');
            script.src = 'js/admin.js';
            script.onload = function() {
                // viewOrderDetail Ìï®Ïàò Ïû¨Ï†ïÏùò
                window.viewOrderDetail = function(orderId) {
                    const order = allOrders.find(o => o.id === orderId);
                    if (!order) return;
                    
                    // üîß ÏàòÏ†ï: products ÌååÏã± Í∞úÏÑ†
                    let products;
                    try {
                        if (typeof order.products === 'string') {
                            products = JSON.parse(order.products || '[]');
                        } else if (Array.isArray(order.products)) {
                            products = order.products;
                        } else if (typeof order.products === 'object') {
                            // Í∞ùÏ≤¥Î•º Î∞∞Ïó¥Î°ú Î≥ÄÌôò
                            products = [order.products];
                        } else {
                            products = [];
                        }
                    } catch (e) {
                        console.error('Ï†úÌíà Îç∞Ïù¥ÌÑ∞ ÌååÏã± Ïò§Î•ò:', e);
                        console.log('ÏõêÎ≥∏ Îç∞Ïù¥ÌÑ∞:', order.products);
                        products = [];
                    }
                    
                    const orderDate = new Date(order.order_date || order.created_at);
                    
                    // Create modal
                    const modal = document.createElement('div');
                    modal.className = 'modal active';
                    modal.id = 'orderDetailModal';
                    modal.innerHTML = `
                        <div class="modal-overlay" onclick="closeOrderModal()"></div>
                        <div class="modal-content" style="max-width: 700px;">
                            <div class="modal-header">
                                <h2><i class="fas fa-receipt"></i> Ï£ºÎ¨∏ ÏÉÅÏÑ∏</h2>
                                <button class="modal-close" onclick="closeOrderModal()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                                <div style="display: grid; gap: 25px;">
                                    <!-- Ï£ºÎ¨∏ Ï†ïÎ≥¥ -->
                                    <div style="background: var(--light-color); padding: 20px; border-radius: 10px;">
                                        <h3 style="margin-bottom: 15px; color: var(--primary-color);">
                                            <i class="fas fa-info-circle"></i> Ï£ºÎ¨∏ Ï†ïÎ≥¥
                                        </h3>
                                        <div style="display: grid; gap: 10px;">
                                            <p><strong>Ï£ºÎ¨∏Î≤àÌò∏:</strong> ${order.order_number}</p>
                                            <p><strong>Ï£ºÎ¨∏ÏùºÏãú:</strong> ${orderDate.toLocaleString('ko-KR')}</p>
                                            <p><strong>Ï£ºÎ¨∏ÏÉÅÌÉú:</strong> <span style="color: #2196f3; font-weight: 600;">${order.status}</span></p>
                                        </div>
                                    </div>
                                    
                                    <!-- Í≥†Í∞ù Ï†ïÎ≥¥ -->
                                    <div style="background: var(--light-color); padding: 20px; border-radius: 10px;">
                                        <h3 style="margin-bottom: 15px; color: var(--primary-color);">
                                            <i class="fas fa-user"></i> Í≥†Í∞ù Ï†ïÎ≥¥
                                        </h3>
                                        <div style="display: grid; gap: 10px;">
                                            <p><strong>Ïù¥Î¶Ñ:</strong> ${order.customer_name}</p>
                                            <p><strong>Ï†ÑÌôîÎ≤àÌò∏:</strong> ${order.customer_phone}</p>
                                            <p><strong>Ïù¥Î©îÏùº:</strong> ${order.customer_email || 'ÎØ∏ÏûÖÎ†•'}</p>
                                            <p><strong>Ïπ¥Ïπ¥Ïò§ÌÜ° ID:</strong> ${order.customer_kakao || 'ÎØ∏ÏûÖÎ†•'}</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Î∞∞ÏÜ° Ï†ïÎ≥¥ -->
                                    <div style="background: var(--light-color); padding: 20px; border-radius: 10px;">
                                        <h3 style="margin-bottom: 15px; color: var(--primary-color);">
                                            <i class="fas fa-map-marker-alt"></i> Î∞∞ÏÜ° Ï†ïÎ≥¥
                                        </h3>
                                        <p style="white-space: pre-wrap;">${order.shipping_address}</p>
                                        ${order.special_request ? `
                                            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid var(--border-color);">
                                                <p><strong>ÏöîÏ≤≠ÏÇ¨Ìï≠:</strong></p>
                                                <p style="white-space: pre-wrap; margin-top: 5px;">${order.special_request}</p>
                                            </div>
                                        ` : ''}
                                    </div>
                                    
                                    <!-- Ï£ºÎ¨∏ ÏÉÅÌíà -->
                                    <div style="background: var(--light-color); padding: 20px; border-radius: 10px;">
                                        <h3 style="margin-bottom: 15px; color: var(--primary-color);">
                                            <i class="fas fa-shopping-cart"></i> Ï£ºÎ¨∏ ÏÉÅÌíà
                                        </h3>
                                        <div style="display: grid; gap: 10px;">
                                            ${products.length > 0 ? products.map(product => `
                                                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: white; border-radius: 8px;">
                                                    <div>
                                                        <p style="font-weight: 600;">${product.name || 'Ï†úÌíàÎ™Ö ÏóÜÏùå'}</p>
                                                        <p style="font-size: 0.9rem; color: #666;">ÏàòÎüâ: ${product.quantity || 1}Í∞ú</p>
                                                    </div>
                                                    <p style="font-weight: 600; color: var(--accent-color);">
                                                        ${formatPrice((product.price || 0) * (product.quantity || 1))}Ïõê
                                                    </p>
                                                </div>
                                            `).join('') : '<p style="color: #999;">Ï£ºÎ¨∏ Ï†úÌíà Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</p>'}
                                        </div>
                                        <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid var(--border-color); text-align: right;">
                                            <p style="font-size: 1.3rem; font-weight: 700; color: var(--accent-color);">
                                                Ï¥ù ${formatPrice(order.total_amount)}Ïõê
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- ÏÉÅÌÉú Î≥ÄÍ≤Ω Î≤ÑÌäº -->
                                <div style="margin-top: 25px; display: flex; gap: 10px; flex-wrap: wrap;">
                                    <button class="btn btn-secondary" onclick="updateOrderStatus('${order.id}', 'Ï†ëÏàò')" style="flex: 1;">Ï†ëÏàò</button>
                                    <button class="btn btn-secondary" onclick="updateOrderStatus('${order.id}', 'ÌôïÏù∏Ï§ë')" style="flex: 1;">ÌôïÏù∏Ï§ë</button>
                                    <button class="btn btn-secondary" onclick="updateOrderStatus('${order.id}', 'Î∞∞ÏÜ°Ï§ÄÎπÑ')" style="flex: 1;">Î∞∞ÏÜ°Ï§ÄÎπÑ</button>
                                    <button class="btn btn-secondary" onclick="updateOrderStatus('${order.id}', 'Î∞∞ÏÜ°Ï§ë')" style="flex: 1;">Î∞∞ÏÜ°Ï§ë</button>
                                    <button class="btn btn-primary" onclick="updateOrderStatus('${order.id}', 'Î∞∞ÏÜ°ÏôÑÎ£å')" style="flex: 1;">Î∞∞ÏÜ°ÏôÑÎ£å</button>
                                    <button class="btn btn-secondary" onclick="updateOrderStatus('${order.id}', 'Ï∑®ÏÜå')" style="flex: 1; background: #f44336;">Ï∑®ÏÜå</button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.body.appendChild(modal);
                    document.body.style.overflow = 'hidden';
                };
                
                console.log('‚úÖ viewOrderDetail Ìï®Ïàò ÏàòÏ†ï ÏôÑÎ£å!');
            };
            document.head.appendChild(script);
        }
    </script>
</body>
</html>
