<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë””ë²„ê·¸ - ì‹¬ì„</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success { border-left: 5px solid #28a745; }
        .error { border-left: 5px solid #dc3545; }
        .warning { border-left: 5px solid #ffc107; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
        button {
            background: #2c5f4f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .product-mini {
            display: inline-block;
            width: 150px;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 5px;
            border-radius: 5px;
            text-align: center;
        }
        .product-mini img {
            width: 100%;
            height: 100px;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <h1>ğŸ” ì‹¤ì‹œê°„ ë””ë²„ê¹…</h1>
    
    <div class="debug-box">
        <button onclick="runFullTest()">ğŸš€ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <button onclick="location.href='index.html'">ğŸ  ë©”ì¸ í˜ì´ì§€</button>
        <button onclick="location.href='admin.html'">âš™ï¸ ê´€ë¦¬ì í˜ì´ì§€</button>
        <button onclick="location.reload()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div id="results"></div>

    <script>
        let testResults = [];

        async function runFullTest() {
            testResults = [];
            document.getElementById('results').innerHTML = '<div class="debug-box warning"><h3>í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì¤‘...</h3></div>';
            
            await test1_CheckURL();
            await test2_CheckAPI();
            await test3_CheckJavaScript();
            await test4_SimulateMainPage();
            
            displayAllResults();
        }

        function addResult(title, status, details, data = null) {
            testResults.push({ title, status, details, data });
        }

        async function test1_CheckURL() {
            addResult(
                'í…ŒìŠ¤íŠ¸ 1: í˜„ì¬ URL í™•ì¸',
                'info',
                `í˜„ì¬ URL: ${window.location.href}\nOrigin: ${window.location.origin}\nPathname: ${window.location.pathname}`
            );
        }

        async function test2_CheckAPI() {
            try {
                const response = await fetch('tables/products?limit=100');
                const result = await response.json();
                
                if (response.ok && result.data && result.data.length > 0) {
                    addResult(
                        'í…ŒìŠ¤íŠ¸ 2: API ì—°ê²°',
                        'success',
                        `âœ… API ì •ìƒ ì‘ë™\nìƒíƒœ: ${response.status}\nì œí’ˆ ìˆ˜: ${result.data.length}ê°œ`,
                        result
                    );
                } else {
                    addResult(
                        'í…ŒìŠ¤íŠ¸ 2: API ì—°ê²°',
                        'error',
                        `âŒ API ì‘ë‹µ ë¬¸ì œ\nìƒíƒœ: ${response.status}\nì œí’ˆ ìˆ˜: ${result.data ? result.data.length : 0}ê°œ`,
                        result
                    );
                }
            } catch (error) {
                addResult(
                    'í…ŒìŠ¤íŠ¸ 2: API ì—°ê²°',
                    'error',
                    `âŒ API ì˜¤ë¥˜: ${error.message}`,
                    error
                );
            }
        }

        async function test3_CheckJavaScript() {
            try {
                // main.js íŒŒì¼ ë¡œë“œ í…ŒìŠ¤íŠ¸
                const response = await fetch('js/main.js');
                const jsCode = await response.text();
                
                const hasLoadProducts = jsCode.includes('function loadProducts');
                const hasDisplayProducts = jsCode.includes('function displayProducts');
                const hasFetch = jsCode.includes("fetch('tables/products");
                
                if (hasLoadProducts && hasDisplayProducts && hasFetch) {
                    addResult(
                        'í…ŒìŠ¤íŠ¸ 3: JavaScript íŒŒì¼',
                        'success',
                        `âœ… main.js ì •ìƒ\n- loadProducts í•¨ìˆ˜: ${hasLoadProducts ? 'âœ…' : 'âŒ'}\n- displayProducts í•¨ìˆ˜: ${hasDisplayProducts ? 'âœ…' : 'âŒ'}\n- API fetch ì½”ë“œ: ${hasFetch ? 'âœ…' : 'âŒ'}\n\níŒŒì¼ í¬ê¸°: ${jsCode.length} ë¬¸ì`
                    );
                } else {
                    addResult(
                        'í…ŒìŠ¤íŠ¸ 3: JavaScript íŒŒì¼',
                        'error',
                        `âŒ main.js ë¬¸ì œ ë°œê²¬\n- loadProducts í•¨ìˆ˜: ${hasLoadProducts ? 'âœ…' : 'âŒ'}\n- displayProducts í•¨ìˆ˜: ${hasDisplayProducts ? 'âœ…' : 'âŒ'}\n- API fetch ì½”ë“œ: ${hasFetch ? 'âœ…' : 'âŒ'}`
                    );
                }
            } catch (error) {
                addResult(
                    'í…ŒìŠ¤íŠ¸ 3: JavaScript íŒŒì¼',
                    'error',
                    `âŒ main.js ë¡œë“œ ì‹¤íŒ¨: ${error.message}`
                );
            }
        }

        async function test4_SimulateMainPage() {
            try {
                // ë©”ì¸ í˜ì´ì§€ì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ì œí’ˆ ë¡œë“œ
                const response = await fetch('tables/products?limit=100');
                const result = await response.json();
                
                if (result.data && result.data.length > 0) {
                    const products = result.data;
                    
                    // ì œí’ˆ ì¹´ë“œ HTML ìƒì„± (ë©”ì¸ í˜ì´ì§€ì™€ ë™ì¼)
                    const productCards = products.slice(0, 6).map(product => `
                        <div class="product-mini">
                            <img src="${product.image_url}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/150?text=No+Image'">
                            <strong>${product.name}</strong><br>
                            ${product.price.toLocaleString()}ì›
                        </div>
                    `).join('');
                    
                    addResult(
                        'í…ŒìŠ¤íŠ¸ 4: ë©”ì¸ í˜ì´ì§€ ì‹œë®¬ë ˆì´ì…˜',
                        'success',
                        `âœ… ì œí’ˆ í‘œì‹œ ì„±ê³µ!\nì´ ${products.length}ê°œ ì œí’ˆ\n\nì¹´í…Œê³ ë¦¬ë³„:\n- ëª©ê±¸ì´: ${products.filter(p => p.category === 'ëª©ê±¸ì´').length}ê°œ\n- íŒ”ì°Œ: ${products.filter(p => p.category === 'íŒ”ì°Œ').length}ê°œ\n- ë°˜ì§€: ${products.filter(p => p.category === 'ë°˜ì§€').length}ê°œ\n\nì²« 6ê°œ ì œí’ˆ ë¯¸ë¦¬ë³´ê¸°:\n${productCards}`
                    );
                } else {
                    addResult(
                        'í…ŒìŠ¤íŠ¸ 4: ë©”ì¸ í˜ì´ì§€ ì‹œë®¬ë ˆì´ì…˜',
                        'error',
                        `âŒ ì œí’ˆ ë°ì´í„° ì—†ìŒ`
                    );
                }
            } catch (error) {
                addResult(
                    'í…ŒìŠ¤íŠ¸ 4: ë©”ì¸ í˜ì´ì§€ ì‹œë®¬ë ˆì´ì…˜',
                    'error',
                    `âŒ ì˜¤ë¥˜: ${error.message}`
                );
            }
        }

        function displayAllResults() {
            const resultsDiv = document.getElementById('results');
            
            let html = '<h2>ğŸ“Š í…ŒìŠ¤íŠ¸ ê²°ê³¼</h2>';
            
            testResults.forEach((result, index) => {
                const statusClass = result.status === 'success' ? 'success' : 
                                  result.status === 'error' ? 'error' : 'warning';
                
                html += `
                    <div class="debug-box ${statusClass}">
                        <h3>${index + 1}. ${result.title}</h3>
                        <pre>${result.details}</pre>
                        ${result.data ? `<details><summary>ìƒì„¸ ë°ì´í„° ë³´ê¸°</summary><pre>${JSON.stringify(result.data, null, 2)}</pre></details>` : ''}
                    </div>
                `;
            });
            
            // ìµœì¢… ì§„ë‹¨
            const successCount = testResults.filter(r => r.status === 'success').length;
            const totalCount = testResults.length;
            
            html += `
                <div class="debug-box ${successCount === totalCount ? 'success' : 'warning'}">
                    <h3>ğŸ¯ ìµœì¢… ì§„ë‹¨</h3>
                    <p><strong>ì„±ê³µ:</strong> ${successCount}/${totalCount} í…ŒìŠ¤íŠ¸</p>
                    ${successCount === totalCount ? 
                        '<p style="color: #28a745; font-size: 1.2rem;">âœ… ëª¨ë“  ì‹œìŠ¤í…œ ì •ìƒ! ë©”ì¸ í˜ì´ì§€ì˜ ìºì‹œë¥¼ ê°•ë ¥ ìƒˆë¡œê³ ì¹¨(Ctrl+Shift+R)í•˜ì„¸ìš”.</p>' :
                        '<p style="color: #dc3545; font-size: 1.2rem;">âŒ ë¬¸ì œê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤. ìœ„ì˜ ì˜¤ë¥˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>'
                    }
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(runFullTest, 500);
        });
    </script>
</body>
</html>
