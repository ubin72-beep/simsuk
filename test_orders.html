<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ë¬¸ ë°ì´í„° í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .success { border-left: 5px solid #28a745; }
        .error { border-left: 5px solid #dc3545; }
        .warning { border-left: 5px solid #ffc107; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            max-height: 400px;
        }
        button {
            background: #2c5f4f;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .order-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>ğŸ›’ ì£¼ë¬¸ ë°ì´í„° í…ŒìŠ¤íŠ¸</h1>
    
    <div class="test-box">
        <button onclick="testOrdersAPI()">ğŸ“¡ ì£¼ë¬¸ API í…ŒìŠ¤íŠ¸</button>
        <button onclick="createTestOrder()">â• í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ ìƒì„±</button>
        <button onclick="location.href='admin.html'">âš™ï¸ ê´€ë¦¬ì í˜ì´ì§€</button>
        <button onclick="location.reload()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div id="results"></div>

    <script>
        async function testOrdersAPI() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="test-box warning"><p>â³ ë¡œë”© ì¤‘...</p></div>';
            
            try {
                console.log('ğŸ“¡ API í˜¸ì¶œ: tables/orders');
                const response = await fetch('tables/orders?limit=100&sort=-created_at');
                console.log('ğŸ“¥ ì‘ë‹µ ìƒíƒœ:', response.status);
                
                const result = await response.json();
                console.log('ğŸ“¦ ì‘ë‹µ ë°ì´í„°:', result);
                
                if (result.data && result.data.length > 0) {
                    resultsDiv.innerHTML = `
                        <div class="test-box success">
                            <h3>âœ… ì£¼ë¬¸ ë°ì´í„° ë°œê²¬!</h3>
                            <p><strong>ì´ ì£¼ë¬¸ ìˆ˜:</strong> ${result.data.length}ê°œ</p>
                            <h4>ì£¼ë¬¸ ëª©ë¡:</h4>
                            ${result.data.map((order, index) => `
                                <div class="order-card">
                                    <strong>${index + 1}. ì£¼ë¬¸ë²ˆí˜¸:</strong> ${order.order_number || 'N/A'}<br>
                                    <strong>ê³ ê°ëª…:</strong> ${order.customer_name || 'N/A'}<br>
                                    <strong>ì „í™”ë²ˆí˜¸:</strong> ${order.customer_phone || 'N/A'}<br>
                                    <strong>ì£¼ë¬¸ ìƒíƒœ:</strong> ${order.status || 'N/A'}<br>
                                    <strong>ì´ ê¸ˆì•¡:</strong> ${(order.total_amount || 0).toLocaleString()}ì›<br>
                                    <strong>ì£¼ë¬¸ì¼ì‹œ:</strong> ${order.order_date ? new Date(order.order_date).toLocaleString() : 'N/A'}
                                </div>
                            `).join('')}
                            <details>
                                <summary>ğŸ“‹ ì „ì²´ ë°ì´í„° ë³´ê¸° (JSON)</summary>
                                <pre>${JSON.stringify(result, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="test-box warning">
                            <h3>âš ï¸ ì£¼ë¬¸ ë°ì´í„° ì—†ìŒ</h3>
                            <p>ë“±ë¡ëœ ì£¼ë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p>ì‘ë‹µ ë°ì´í„°:</p>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                            <button onclick="createTestOrder()">í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ ìƒì„±í•˜ê¸°</button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('âŒ ì˜¤ë¥˜:', error);
                resultsDiv.innerHTML = `
                    <div class="test-box error">
                        <h3>âŒ API ì˜¤ë¥˜</h3>
                        <p><strong>ì˜¤ë¥˜ ë©”ì‹œì§€:</strong> ${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }

        async function createTestOrder() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="test-box warning"><p>â³ í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ ìƒì„± ì¤‘...</p></div>';
            
            const testOrder = {
                order_number: `ORD-${new Date().getFullYear()}${String(new Date().getMonth()+1).padStart(2,'0')}${String(new Date().getDate()).padStart(2,'0')}-${String(Math.floor(Math.random()*9999)+1).padStart(4,'0')}`,
                customer_name: 'í…ŒìŠ¤íŠ¸ ê³ ê°',
                customer_phone: '010-1234-5678',
                customer_email: 'test@example.com',
                customer_kakao: 'test_kakao',
                shipping_address: 'ì„œìš¸ì‹œ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123',
                special_request: 'í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ì…ë‹ˆë‹¤',
                products: JSON.stringify([
                    {
                        id: 'test1',
                        name: 'í…ŒìŠ¤íŠ¸ ì œí’ˆ1',
                        price: 45000,
                        quantity: 1
                    },
                    {
                        id: 'test2',
                        name: 'í…ŒìŠ¤íŠ¸ ì œí’ˆ2',
                        price: 52000,
                        quantity: 2
                    }
                ]),
                total_amount: 149000,
                status: 'ì ‘ìˆ˜',
                order_date: new Date().toISOString()
            };
            
            try {
                const response = await fetch('tables/orders', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(testOrder)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    resultsDiv.innerHTML = `
                        <div class="test-box success">
                            <h3>âœ… í…ŒìŠ¤íŠ¸ ì£¼ë¬¸ ìƒì„± ì™„ë£Œ!</h3>
                            <p><strong>ì£¼ë¬¸ë²ˆí˜¸:</strong> ${testOrder.order_number}</p>
                            <p><strong>ê³ ê°ëª…:</strong> ${testOrder.customer_name}</p>
                            <p><strong>ì´ ê¸ˆì•¡:</strong> ${testOrder.total_amount.toLocaleString()}ì›</p>
                            <button onclick="testOrdersAPI()">ì£¼ë¬¸ ëª©ë¡ ë‹¤ì‹œ í™•ì¸</button>
                            <details>
                                <summary>ìƒì„±ëœ ë°ì´í„° ë³´ê¸°</summary>
                                <pre>${JSON.stringify(result, null, 2)}</pre>
                            </details>
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="test-box error">
                            <h3>âŒ ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨</h3>
                            <p><strong>ìƒíƒœ:</strong> ${response.status}</p>
                            <pre>${JSON.stringify(result, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="test-box error">
                        <h3>âŒ ì˜¤ë¥˜ ë°œìƒ</h3>
                        <p>${error.message}</p>
                        <pre>${error.stack}</pre>
                    </div>
                `;
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(testOrdersAPI, 500);
        });
    </script>
</body>
</html>
